---
import FormInput from './FormInput.astro';
---

<section
  class="col-span-12 md:col-span-7 grid-cols-12 md:grid-cols-7 grid border-b py-12"
>
  <form
    action="/api/contact"
    method="POST"
    id="contact-form"
    class="col-span-6 col-start-2"
  >
    <FormInput
      id="name"
      type="text"
      label="Jméno:"
      placeholder="vaše jméno ..."
      required="true"
    />
    <FormInput
      id="email"
      type="email"
      label="Email:"
      placeholder="váš email ..."
      required="true"
    />
    <FormInput
      id="company"
      type="text"
      label="Společnost:"
      placeholder="vaše společnost ..."
      required="true"
    />
    <FormInput
      id="description"
      type="textarea"
      label="Popis:"
      placeholder="prosím napište nám vaší představu projektu včetně požadavků, funkcí a rozsahu ..."
      required="true"
    />
    <button
      type="submit"
      class="py-3 px-4 w-full cursor-pointer bg-secondary-700 text-tertiary-50 custom-button text-center hover:italic font-bold font-mono"
    >
      Odeslat
    </button>
    <div id="form-message" class="hidden"></div>
  </form>
</section>

<style>
  .custom-button {
    box-shadow: 6px 6px 0px 0px var(--color-secondary-300);
    transition: all 150ms ease-in-out;
  }
  .custom-button:hover {
    box-shadow: 10px 10px 0px 0px var(--color-secondary-300);
    transform: translate(-4px, -4px);
  }

  .custom-button:active {
    box-shadow: 4px 4px 0px 0px var(--color-secondary-300);
    transform: translate(2px, 2px);
  }
</style>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitButton = form?.querySelector(
    'button[type="submit"]'
  ) as HTMLButtonElement;
  const formMessage = document.getElementById('form-message') as HTMLDivElement;

  submitButton?.addEventListener('click', () => {
    form?.classList.add('was-validated');
  });

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      submitButton.disabled = true;
      submitButton.textContent = 'Odesílání...';

      formMessage.classList.add('hidden');

      try {
        const formData = new FormData(form);

        const response = await fetch('/api/contact', {
          method: 'POST',
          body: formData,
        });

        const result = await response.json();

        if (result.success) {
          formMessage.textContent = result.message;
          formMessage.className =
            'mt-6 p-4 bg-primary-100 text-primary-800 border';
          form.reset();
          form.classList.remove('was-validated');
        } else {
          formMessage.textContent = result.errors.join(', ');
          formMessage.className =
            'mt-6 p-4 bg-red-100 text-red-800 border border-red-300!';
        }
      } catch (error) {
        console.error('Form submission error:', error);
        formMessage.textContent =
          'Nepodařilo se odeslat formulář :(\n Zkuste to prosím znovu, nebo nám napište přímo email.';
        formMessage.className =
          'mt-6 p-4 bg-red-100 text-red-800 border border-red-300!';
      } finally {
        submitButton.textContent = 'Odeslat';
        submitButton.disabled = false;
      }
    });
  }
</script>
